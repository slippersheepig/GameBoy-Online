user  nginx;
worker_processes  auto;
error_log  /var/log/nginx/error.log notice;
pid        /var/run/nginx.pid;

events {
    worker_connections  1024;
}

http {
    # 使用系统默认的 mime 类型表
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;

    gzip on;
    gzip_types text/plain text/css application/javascript application/json application/xhtml+xml image/svg+xml;

    server {
        listen       80 default_server;
        server_name  _;

        root /usr/share/nginx/html;
        index index.xhtml index.html mobile.html;

        # 精确匹配 manifest.webapp，确保以正确的 MIME 返回
        location = /manifest.webapp {
            # 指定 manifest 的 MIME
            default_type application/manifest+json;
            # 确保静态文件存在，否则返回 404
            try_files $uri =404;
        }

        # 明确为 .xhtml 返回 application/xhtml+xml 防止下载
        location ~ \.xhtml$ {
            default_type application/xhtml+xml;
            try_files $uri =404;
        }

        # 其它静态资源的常规处理
        location / {
            try_files $uri $uri/ =404;
        }
    }
}
