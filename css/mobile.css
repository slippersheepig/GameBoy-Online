html, body {
  margin: 0;
  padding: 0;
  width: 100%;
  height: 100%;
  background-color: black;
  font-family: Verdana;
}

#gameboy_shell {
  height: 100%;
  min-height: 480px;
  min-width: 320px;
  border-top-left-radius: 15px;
  border-top-right-radius: 15px;
  border-bottom-left-radius: 15px;
  border-bottom-right-radius: 45px;
  box-shadow: inset -15px 16px 6px -12px rgba(255,255,255, 0.5), inset 15px -11px 6px -11px rgba(0,0,0,0.5);
}

#on_off {
  margin-left: 10%;
  font-size: 10pt;
  text-shadow: 0px 0px 2px #000;
}

#screen_cover {
  background-color: #525E59;
  width: 80%;
  height: 40%;
  margin: 0 auto;
  border: 1px solid black;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  border-bottom-left-radius: 5px;
  border-bottom-right-radius: 30px;
}

#power {
  float: left;
  position: relative;
  top: 30%;
  font-size: 8pt;
  color: white;
  padding-left: 5px;
}

.two_column {
  width: 30px;
  height: 15px;
}

#power_light {
  float: left;
  position: static;
  width: 10px;
  height: 10px;
  background-color: red;
  margin-left: 5px;
  margin-top: 2px;
  border-radius: 10px;
}

#power_light +div {
  float: right;
}

#canvas_container {
  width: 160px;
  margin: 20px auto 0 auto;
}

#screen_cover > div:last-child {
  position: relative;
  left: 15%;
  width: 120px;
  font-size: 10pt;
  text-align: center;
  color: white;
  font-style: oblique;
}

#pocket {
  color: #525E59;
  background-color: white;
  font-size: 8pt;
}

#nintendo {
  border-radius: 10px;
  width: 25%;
  text-align: center;
  margin: 10px auto 0 auto;
  padding: 0 5px;
  text-shadow: 0px 0px 2px #000;
  box-shadow: 0px 0px 2px #000, inset 0px 0px 2px #000;
}

#d_pad {
  width: 70px;
  height: 70px;
  position: relative;
  top: 20px;
  left: 10%;
}

#d_pad > div {
  background-color: #525E59;
}

#d_pad_up {
  box-shadow: inset -15px 10px 10px -12px rgba(255,255,255, 0.5), inset 15px -11px 6px -11px rgba(0,0,0,0.5);
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  width: 33%;
  height: 33%;
  margin: 0 auto;
}

#d_pad_left_right {
  box-shadow: inset -15px 10px 10px -12px rgba(255,255,255, 0.5), inset 15px -11px 6px -11px rgba(0,0,0,0.5);
  border-radius: 5px;
  height: 33%;
  margin: 0 auto;
}

#d_pad_down {
  box-shadow: inset -15px 10px 10px -12px rgba(255,255,255, 0.5), inset 15px -11px 6px -11px rgba(0,0,0,0.5);
  border-bottom-left-radius: 5px;
  border-bottom-right-radius: 5px;
  width: 33%;
  height: 33%;
  margin: 0 auto;
}

#d_pad_left {
  width: 33%;
  height: 100%;
  float: left;
}

#d_pad_center {
  border: 1px solid black;
  height: 20px;
  width: 20px;
  margin: 0 auto;
  border-radius: 20px;
  /*box-shadow: inset 5px -5px 6px 0px rgba(255,255,255, 0.5);*/
  box-shadow: inset -15px 10px 10px -12px rgba(0,0,0, 0.5), inset 15px -11px 6px -11px rgba(255,255,255,0.5);
}

#d_pad_right {
  width: 33%;
  height: 100%;
  float: right;
}

#arrow_up, #arrow_down, #arrow_left, #arrow_right {
  width: 0;
  height: 0;
  margin: 0 auto;
}

#arrow_up {
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-bottom: 20px solid black;
}

#arrow_left {
  border-top: 10px solid transparent;
  border-right: 20px solid black;
  border-bottom: 10px solid transparent;
}

#arrow_right {
  border-left: 20px solid black;
  border-top: 10px solid transparent;
  border-bottom: 10px solid transparent;
}
#arrow_down {
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-top: 20px solid black;
}

#a_button_group {
  left: 75%;
  top: 55%;
}

#b_button_group {
  left: 55%;
  top: 60%;
}

#select_button_group {
  left: 33%;
  top: 85%;
}

#start_button_group {
  right: 33%;
  top: 85%
}

.button_group {
  position: absolute;
  text-align: center;
  color: #525E59;
  font-size: 10pt;
}

.button_group div {
  width: 40px;
  background-color: #525E59;
  border-radius: 20px;
  margin: 0 auto 10px auto;
  box-shadow: inset -15px 10px 10px -12px rgba(255,255,255, 0.5), inset 15px -11px 6px -11px rgba(0,0,0,0.5);
}

.button_group .round_button {
  height: 40px;
}

.button_group .flat_button {
  height: 15px;
}

#speaker {
  position: relative;
  left: 70%;
  top: 15%;
}

/* === Patched mobile layout & improved on-screen controls (non-destructive) === */
@media (max-width: 900px) {
  /* Hide desktop windowing UI to avoid overlay */
  .window { display: none !important; }

  /* Full-viewport mobile shell */
  #mobile_shell_wrapper {
    display: block !important;
    position: fixed;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
    -webkit-tap-highlight-color: transparent;
    background: linear-gradient(180deg, #060606, #000000);
    box-sizing: border-box;
    padding: 0;
  }

  /* Make shell fill the viewport and use flex layout */
  #gameboy_shell {
    position: relative;
    box-sizing: border-box;
    width: 100%;
    height: 100%;
    padding-top: 4%;
    padding-bottom: 22%; /* leave room for controls */
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    overflow: hidden;
  }

  /* Canvas mount: center the game screen and allow scaling */
  #mobile_canvas_mount {
    text-align: center;
    margin: 0 auto;
    width: 100%;
    flex: 0 0 auto;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #mobile_canvas_mount #gfx,
  #mobile_canvas_mount #gfx canvas {
    display: block !important;
    margin: 0 auto;
    position: relative;
    width: auto !important;
    height: auto !important;
    max-width: calc(100vw - 32px) !important;
    max-height: calc(60vh) !important;
    image-rendering: pixelated;
  }

  /* Controls overlay (D-pad left, A/B right, Start/Select centered) */
  .mobile-controls-overlay {
    position: fixed;
    left: 0;
    right: 0;
    bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    padding: 8px 12px;
    gap: 8px;
    pointer-events: none;
    z-index: 10000;
  }

  .mobile-controls-overlay .controls-side {
    width: 48%;
    display: flex;
    justify-content: center;
    pointer-events: auto;
  }

  /* D-pad visual (keeps original #d_pad but allows better layout) */
  #d_pad {
    position: relative;
    width: calc(min(36vmin, 140px));
    height: calc(min(36vmin, 140px));
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(3, 1fr);
    gap: 6px;
    align-items: center;
    justify-items: center;
    left: 6%;
    bottom: 0;
    z-index: 10001;
  }
  #d_pad > div { background: transparent; box-shadow: none; width: 100%; height: 100%; display:flex; align-items:center; justify-content:center; }
  #d_pad_up { grid-column: 2; grid-row: 1; width: 68%; height: 68%; border-radius: 12px; background: linear-gradient(180deg,#3a3f3a,#2b2f2b); box-shadow: 0 8px 18px rgba(0,0,0,0.6), inset 0 -2px 0 rgba(255,255,255,0.02); }
  #d_pad_left  { grid-column: 1; grid-row: 2; width: 68%; height: 68%; border-radius: 12px; background: linear-gradient(180deg,#3a3f3a,#2b2f2b); box-shadow: 0 8px 18px rgba(0,0,0,0.6), inset 0 -2px 0 rgba(255,255,255,0.02); }
  #d_pad_right { grid-column: 3; grid-row: 2; width: 68%; height: 68%; border-radius: 12px; background: linear-gradient(180deg,#3a3f3a,#2b2f2b); box-shadow: 0 8px 18px rgba(0,0,0,0.6), inset 0 -2px 0 rgba(255,255,255,0.02); }
  #d_pad_down  { grid-column: 2; grid-row: 3; width: 68%; height: 68%; border-radius: 12px; background: linear-gradient(180deg,#3a3f3a,#2b2f2b); box-shadow: 0 8px 18px rgba(0,0,0,0.6), inset 0 -2px 0 rgba(255,255,255,0.02); }
  #d_pad_center { display:none; } /* keep original center hidden */

  /* Arrow icons (improve contrast) */
  #arrow_up, #arrow_down, #arrow_left, #arrow_right {
    width: 0; height: 0; margin: 0 auto; display:block;
  }
  #arrow_up { border-left: 8px solid transparent; border-right: 8px solid transparent; border-bottom: 16px solid #f6f6f6; opacity: 0.95; }
  #arrow_left { border-top: 8px solid transparent; border-right: 16px solid #f6f6f6; border-bottom: 8px solid transparent; opacity: 0.95; }
  #arrow_right { border-left: 16px solid #f6f6f6; border-top: 8px solid transparent; border-bottom: 8px solid transparent; opacity: 0.95; }
  #arrow_down { border-left: 8px solid transparent; border-right: 8px solid transparent; border-top: 16px solid #f6f6f6; opacity: 0.95; }

  /* Action buttons group: A / B */
  .button_group { position: relative; text-align: center; color: #fff; font-size: 12pt; pointer-events: auto; }
  .button_group .round_button, .button_group .round_action {
    width: calc(min(20vmin, 72px));
    height: calc(min(20vmin, 72px));
    border-radius: 999px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    font-size: 1.05rem;
    background: radial-gradient(circle at 30% 20%, #ff7b7b, #d64545);
    color: #fff;
    box-shadow: 0 10px 22px rgba(0,0,0,0.6), inset 0 -3px 0 rgba(255,255,255,0.02);
    user-select: none;
    -webkit-user-select: none;
    touch-action: none;
  }

  /* Increase Start / Select visibility and place them centered */
  #select_button_group, #start_button_group {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: 4%;
    display: flex;
    gap: 10px;
    z-index: 10001;
    pointer-events: auto;
  }
  #select_button_group .flat_button, #start_button_group .flat_button {
    min-width: 56px;
    height: 36px;
    border-radius: 10px;
    font-size: 0.85rem;
    background: linear-gradient(180deg,#3a3f3a,#2b2f2b);
    color: #fff;
    display:inline-flex;
    align-items:center;
    justify-content:center;
    box-shadow: 0 8px 18px rgba(0,0,0,0.5);
  }

  /* Ensure speaker sits above controls */
  #speaker { position: absolute !important; right: 6% !important; bottom: 12% !important; width: 28px !important; height: auto !important; z-index: 10000; }

  /* Prevent selection/scroll while touching controls */
  .button_group, #d_pad, #d_pad * { touch-action: none; -webkit-user-select: none; user-select: none; -ms-touch-action: none; }

  /* Hide desktop menubar */
  .menubar { display: none !important; }
}
